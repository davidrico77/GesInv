<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />


<!-- Bootstrap Core CSS -->
<link type="text/css"
	href="../../resources/bower_components/bootstrap/dist/css/bootstrap.min.css"
	rel="stylesheet"
	data-th-href="@{/resources/bower_components/bootstrap/dist/css/bootstrap.min.css}" />


<!-- MetisMenu CSS -->
<link type="text/css"
	href="../../resources/bower_components/metisMenu/dist/metisMenu.min.css"
	rel="stylesheet"
	data-th-href="@{/resources/bower_components/metisMenu/dist/metisMenu.min.css}" />

<!-- Custom CSS -->
<link type="text/css" href="../../resources/dist/css/sb-admin-2.css"
	rel="stylesheet" data-th-href="@{/resources/dist/css/sb-admin-2.css}" />

<!-- Custom Fonts -->
<link
	href="../../resources/bower_components/font-awesome/css/font-awesome.min.css"
	rel="stylesheet" type="text/css"
	data-th-href="@{/resources/bower_components/font-awesome/css/font-awesome.min.css}" />

<title>VIAJES</title>
</head>
<body class="container">
	<h1>ANEXO III - MEMORIA JUSTIFICATIVA – ORDEN DE PAGO</h1>

	<div class="panel panel-default">
		<div class="panel-heading">
			<p class="panel-title">Introduzca valores Viaje</p>
		</div>

		<div class="panel-body">

			<form class="form-horizontal" role="form" action="#"
				th:action="@{'/proyecto/{idProyecto}/viajes'  (idProyecto=*{proyecto.id})}"
				th:object="${viaje}" method="POST">

				<div class="form-group"
					th:classappend="${#fields.hasErrors('fecha')} ? has-error">
					<label class="control-label col-md-2" for="fecha">Fecha:</label>
					<div class="col-md-2">
						<input class="form-control" th:field="*{fecha}" type="date" /> <span
							class="help-block" th:errors="*{fecha}">[errors]</span>
					</div>
				</div>
				<div class="form-group"
					th:classappend="${#fields.hasErrors('numOrden')} ? has-error">
					<label class="control-label col-md-2" for="numOrden">Num
						Orden:</label>
					<div class="col-md-10">
						<input class="form-control" th:field="*{numOrden}" type="text" />
						<span class="help-block" th:errors="*{numOrden}">[errors]</span>
					</div>
				</div>

				<div class="form-group">
					<label class="control-label col-md-2"
						for=" proyecto.numContabilidad">Nº Contabilidad</label>
					<div class="col-md-10">
						<input class="form-control" th:field="*{proyecto.numContabilidad}"
							type="text" readonly="readonly" />
					</div>
				</div>

				<div class="panel panel-default">
					<div class="panel-heading">
						<p class="panel-title">Datos Investigador Principal</p>
					</div>
					<div class="panel-body">
						<div class="form-group">
							<label class="control-label col-md-2" for="user.nombre">Nombre</label>
							<div class="col-md-10">
								<input class="form-control" th:field="${user.nombre}"
									type="text" readonly="readonly" />
							</div>
						</div>

						<div class="form-group">
							<label class="control-label col-md-2" for="user.apellidos">Apellidos</label>
							<div class="col-md-10">
								<input class="form-control" th:field="${user.apellidos}"
									type="text" readonly="readonly" />
							</div>
						</div>

						<div class="form-group">
							<label class="control-label col-md-2"
								for="proyecto.investigadorPrincipal.departamento">Departamento</label>
							<div class="col-md-10">
								<input class="form-control"
									th:value="*{proyecto.investigadorPrincipal.departamento}"
									type="text" readonly="readonly" />
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-md-2"
								for="proyecto.investigadorPrincipal.centro">Centro</label>
							<div class="col-md-10">
								<input class="form-control"
									th:value="*{proyecto.investigadorPrincipal.centro}" type="text"
									readonly="readonly" />
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-md-2" for="user.telefono">Teléfono</label>
							<div class="col-md-10">
								<input class="form-control" th:field="${user.telefono}"
									type="text" readonly="readonly" />
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-md-2" for="user.email">email</label>
							<div class="col-md-10">
								<input class="form-control" th:field="${user.email}" type="text"
									readonly="readonly" />
							</div>
						</div>
					</div>
				</div>

				<div class="panel panel-default">
					<div class="panel-heading">
						<p class="panel-title">JUSTIFICACION PARA VIAJES</p>
					</div>
					<div class="panel-body">

						<div class="form-group">
							<label class="control-label col-md-2" for="">Nombre y
								apellidos:</label>
							<div class="col-md-10">
								<input class="form-control"
									th:value="*{proyecto.investigadorPrincipal.centro}" type="text" />
							</div>
						</div>

						<div class="form-group">
							<label class="control-label col-md-2" for="relacion">Relacion
								con el contrato:</label>

							<div class="radio">
								<label> <input type="radio" value="miembro"
									name="relacion">Miembro del proyecto
								</label>
							</div>
							<div class="radio">
								<label><input type="radio" value="invitado"
									name="relacion">Profesor invitado</label>
							</div>
						</div>

						<div class="form-group">
							<label class="control-label col-md-2" for="objetoDesplazamiento">Objeto
								del desplazamiento:</label>
							<div class="col-md-10">
								<textarea class="form-control"
									th:field="*{objetoDesplazamiento}"> </textarea>
							</div>
						</div>

						<div class="form-group">
							<label class="control-label col-md-2" for="itinerario">Itinerario:</label>
							<div class="col-md-10">
								<input class="form-control" th:field="*{itinerario}" type="text" />
							</div>
						</div>

						<div class="form-group">
							<label class="control-label col-md-2">Fecha Salida:</label>
							<div class="col-md-2">
								<input type="date" class="form-control"
									th:field="*{fechaInicio}" placeholder="Fecha Salida" />
							</div>
						</div>

						<div class="form-group">
							<label class="control-label col-md-2">Fechas LLegada:</label>
							<div class="col-md-2">
								<input type="date" class="form-control" th:field="*{fechaFin}"
									placeholder="Fecha Llegada" />
							</div>
						</div>
					</div>
				</div>

				<div class="panel panel-default">
					<div class="panel-heading">
						<p class="panel-title">JUSTIFICACION DE GASTOS</p>
					</div>

					<div class="panel-body">

						<div class="form-group">
							<label class="control-label col-md-2" for="mediosTransporte">Medios
								de transporte:</label>
							<div class="col-md-3">
								<select class="form-control col-md-3 " name="medios" id="mediosTransporte">
									<option value=""> --- Seleccion de Transporte --- </option>
									<option value="Avion">Avión</option>
									<option value="Tren">Tren</option>
									<option value="Bus">Autobús</option>
									<option value="Taxis">Taxis</option>
									<option value="Coche">Coche</option>
									<option value="Otros">Otros</option>
								</select>
							</div>
							<div class="col-md-5">
								<div class="col-md-2">
									<button onclick="appendMedioTransporte()" class="btn btn-success"
										type="button">+</button>
								</div>
							</div>
						</div>

						<div class="panel-body">
							<table class="table table-bordered ">
								<thead>
									<tr>
										<th class="col-md-2 text-center">Tipo</th>
										<th class="col-md-4 text-center">Descripcion</th>
										<th class="col-md-2 text-center">Factor</th>
										<th class="col-md-2 text-center">KM</th>
										<th class="col-md-2 text-center">Importe</th>
										<th class="col-md-2 text-center">Eliminar</th>										
									</tr>
								</thead>
								<tbody id="gastos">		
														
								</tbody>
							</table>

						</div>

					</div>
					
					<div class="panel-body">
							<table  class="table">
								<thead>
									<tr>
										<th class="col-md-2 text-center">Num Dieta</th>
										<th class="col-md-4 text-center">Pais</th>
										<th class="col-md-2 text-center">Importe</th>									
									</tr>
								</thead>
								<tbody id="dietas">
									<tr id="dietas" >
											<td class="col-md-2  ">	
												<input type="text" class="form-control text-center"  id="numDietas" value="1" onchange="actualizarImporteDietas();" />																				
											</td>
											<td class="col-md-4">
												<select class="form-control col-md-4" id="listaDietas" >
													<option th:each="dieta : ${dietas}" th:attr="data-importe=${dieta.importe}"
														th:value="${dieta.id}" th:text="${dieta.pais}"></option>
												</select>
												
											</td>
											<td class="col-md-2"  >
												<input type="text"	class="form-control text-center " id="importeDieta" th:field="*{importeDieta}" readonly="readonly"/>
											</td>					
											
										</tr>
								
								</tbody>

							</table>

						</div>

				</div>
				
				<div class="form-group">
							<label class="control-label col-md-2" for="congreso">Inscripción Congreso:</label>
							<div class="col-md-10">
								<input class="form-control" th:field="*{congreso}" type="text" />
							</div>
				</div>
				<div class="form-group">
							<label class="control-label col-md-2" for="seminario">Seminario:</label>
							<div class="col-md-10">
								<input class="form-control" th:field="*{seminario}" type="text" />
							</div>
				</div>
				<div class="form-group">
							<label class="control-label col-md-2" for="reunion">Reunión:</label>
							<div class="col-md-10">
								<input class="form-control" th:field="*{reunion}" type="text" />
							</div>
				</div>
				
				<div class="form-group">
							<label class="control-label col-md-2" for="pagarA">Pagar a:</label>
							<div class="col-md-10">
								<input class="form-control" th:field="*{pagarA}" type="text" />
							</div>
				</div>
				
				<div class="form-group">
							<label class="control-label col-md-2" for="observaciones">Observaciones:</label>
							<div class="col-md-10">
								<textarea class="form-control" th:field="*{observaciones}" ></textarea>
							</div>
				</div>
				

				<!-- Change this to a button or input when using this as a form -->
				<input type="submit" class="btn btn-lg btn-success btn-block"
					value="Add Viaje" /> <input type="hidden"
					th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

			</form>

		</div>

	</div>


<!-- jQuery -->
<script src="../../resources/bower_components/jquery/dist/jquery.min.js"
	data-th-src="@{/resources/bower_components/jquery/dist/jquery.min.js}">
		
</script>

<!-- Bootstrap Core JavaScript -->
<script
	src="../../resources/bower_components/bootstrap/dist/js/bootstrap.min.js"
	data-th-src="@{/resources/bower_components/bootstrap/dist/js/bootstrap.min.js}">
		
	</script>

<!-- Metis Menu Plugin JavaScript -->
<script
	src="../../resources/bower_components/metisMenu/dist/metisMenu.min.js"
	data-th-src="@{/resources/bower_components/metisMenu/dist/metisMenu.min.js}">
		
	</script>

<!-- Custom Theme JavaScript -->
<script src="../../resources/dist/js/sb-admin-2.js"
	data-th-src="@{/resources/dist/js/sb-admin-2.js}">
		
	</script>

<script th:inline="javascript">
function calcularImporte(input){
	var importePrecioKm = /*[[${importePrecioKm}]]*/ 0.19;
	var valor = importePrecioKm * Number(input.value) ;
	
	$('#'+input.name).val(valor);
	
}
</script>


<script type="text/javascript">

	function appendMedioTransporte(){
		
		if (document.getElementById("mediosTransporte").value != "")
		{
		
			var count = $('#gastos tr').length;
			var nuevoGasto;
			
			if (count ==0)
				nuevoGasto = $(' <tr id="gasto0" th:each="gasto,gastoStat : *{gastos}"> ');
			else
				nuevoGasto = $('<tr></tr>');
			
			var auxTipo = $('<td class="col-md-2"></td>');
			var auxDescripcion = $('<td class="col-md-2"></td>');
			var auximporte = $('<td class="col-md-2"></td>');
			
			//Campos no significativos para la entity
			var auxFactor;
			var auxKM;
			
			var importe; 
			//XXX $('#mediosTransporte').val() 
			//XXX
			if (document.getElementById("mediosTransporte").value == "Coche"){
				auxFactor = $('<td class="col-md-2"></td>');				
				auxFactorTD = $('<input type="text" name="factor" readonly="readonly" class="form-control text-center" />').attr('value', 0.19);
				$(auxFactor).append(auxFactorTD);
				auxKM = $('<td class="col-md-2"></td>');
				auxKMTD = $('<input type="text" class="form-control text-center" onchange="calcularImporte(this)"/>').attr('name', 'km'+count);
				$(auxKM).append(auxKMTD);
				//El importe es calculado automaticamente
				importe = $('<input type="text" class="form-control col-md-2 text-center" readonly="readonly" /> ').attr({'name': 'gastos[' + count + '].importe', 'id': 'km'+count});
			}
			else {
				auxFactor = $('<td class="col-md-2"></td>');
				auxKM = $('<td class="col-md-2"></td>');
				importe = $(
				'<input type="text" class="form-control col-md-2 text-center"/> ').attr('name', 'gastos[' + count + '].importe');
			}
				
			//botones
			var auxbtnMenos = $('<td class="col-md-2"></td>');
	
			var tipo= $(
					'<input type="text" class="form-control col-md-2 text-center" readonly="readonly" />').attr({'name': 'gastos[' + count + '].tipo', 'value': document.getElementById("mediosTransporte").value});
			
			var descripcion;
			if (document.getElementById("mediosTransporte").value == "Otros"){
				descripcion = $('<input type="text" class="form-control col-md-4 text-center " />').attr('name', 'gastos[' + count + '].descripcion');
			}
			else descripcion = $('<input type="text" class="form-control col-md-4 text-center" readonly="readonly" />').attr('name', 'gastos[' + count + '].descripcion');
			
						
			var btnMenos = $('<button onclick="removeText(this.id)" class="btn btn-danger form-control" type="button">-</button>').attr('id', 'btnMenos' + count );
		
			$(auxTipo).append(tipo);
			$(auxDescripcion).append(descripcion);
			$(auximporte).append(importe);
			
			//botones
			$(auxbtnMenos).append(btnMenos);
			
			$(nuevoGasto).append(auxTipo);
			$(nuevoGasto).append(auxDescripcion);
			
			//Campos no significativos
			$(nuevoGasto).append(auxFactor);
			$(nuevoGasto).append(auxKM);
			
			$(nuevoGasto).append(auximporte);
			
					
			//botones
			$(nuevoGasto).append(auxbtnMenos);
			
			//idNuevo
			$(nuevoGasto).attr('id', 'gasto' + count);
			
			
			$('#gastos').append(nuevoGasto);
		
			}
		
	}
		
</script>
<script type="text/javascript">
function redondeo(numero, decimales)
{
	var flotante = parseFloat(numero);
	var resultado = Math.round(flotante*Math.pow(10,decimales))/Math.pow(10,decimales);
	return resultado;
}
</script>
<script type="text/javascript">
    function actualizarImporteDietas() {
   
       var valueSelected = $('#listaDietas option:selected').attr("data-importe");
       
       var importeTotal = Number(valueSelected) * ($('#numDietas').val());
       
       importeTotal = redondeo( importeTotal, 2)
 	  
 	  $('#importeDieta').val(importeTotal);
    }
</script>


<!-- Por consola si funciona! -->
<script >
$('#listaDietas').change(function () {
	    
	  actualizarImporteDietas();
	  
	  
});
</script>


</body>
</html>